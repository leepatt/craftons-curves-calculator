(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5926:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>J});var a=i(5155),n=i(2115),r=i(1368),s=i(2596),l=i(9688);function o(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,l.QP)((0,s.$)(t))}let d={isValidPositiveNumber:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Number.isFinite(e)&&e>t&&e<=i},isValidAngle:e=>Number.isFinite(e)&&e>=.1&&e<=359.9,isValidRadiusConfig:(e,t,i)=>!!d.isValidPositiveNumber(e)&&!!d.isValidPositiveNumber(t)&&("external"!==i||!(e<=t)),isValidChordLength:(e,t)=>!!d.isValidPositiveNumber(e)&&!!d.isValidPositiveNumber(t)&&e<=2*t,isValidArea:e=>Number.isFinite(e)&&e>0&&e<1e3,isValidEfficiency:e=>Number.isFinite(e)&&e>=.01&&e<=1,isValidSheetDimensions:(e,t)=>d.isValidPositiveNumber(e,100,1e4)&&d.isValidPositiveNumber(t,100,1e4),clamp:(e,t,i)=>Math.max(t,Math.min(i,e)),safeDivide:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!Number.isFinite(e)||!Number.isFinite(t)||0===t)return i;let a=e/t;return Number.isFinite(a)?a:i},safeCalculate:(e,t)=>{try{return e()}catch(e){return console.warn("Calculation error caught:",e),t}}},c=n.forwardRef((e,t)=>{let{className:i,...n}=e;return(0,a.jsx)("label",{ref:t,className:o("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",i),...n})});c.displayName="Label";let u=n.forwardRef((e,t)=>{let{className:i,type:n,...r}=e;return(0,a.jsx)("input",{type:n,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:t,...r})});u.displayName="Input";let m=n.forwardRef((e,t)=>{let{className:i,children:n,onValueChange:r,onChange:s,...l}=e;return(0,a.jsx)("select",{className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:t,onChange:e=>{null==r||r(e.target.value),null==s||s(e)},...l,children:n})});m.displayName="Select";let h=n.createContext({}),f=n.forwardRef((e,t)=>{let{className:i,value:n,onValueChange:r,children:s,type:l="single",...d}=e;return(0,a.jsx)(h.Provider,{value:{value:n,onValueChange:r},children:(0,a.jsx)("div",{ref:t,className:o("flex items-center gap-1 rounded-md",i),...d,children:s})})}),g=n.forwardRef((e,t)=>{let{className:i,value:r,children:s,onClick:l,variant:d="default",...c}=e,u=n.useContext(h),m=u.value===r;return(0,a.jsx)("button",{ref:t,className:o("inline-flex items-center justify-center rounded-md px-3 py-2 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border",{default:m?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50",outline:m?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}[d],i),onClick:e=>{var t;null==(t=u.onValueChange)||t.call(u,r),null==l||l(e)},...c,children:s})});f.displayName="ToggleGroup",g.displayName="ToggleGroupItem";var p=i(1243);let x=n.forwardRef((e,t)=>{let{className:i,variant:n="default",size:r="default",...s}=e;return(0,a.jsx)("button",{className:o("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-primary-foreground hover:bg-primary/90":"default"===n,"bg-destructive text-destructive-foreground hover:bg-destructive/90":"destructive"===n,"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"outline"===n,"bg-secondary text-secondary-foreground hover:bg-secondary/80":"secondary"===n,"hover:bg-accent hover:text-accent-foreground":"ghost"===n,"text-primary underline-offset-4 hover:underline":"link"===n},{"h-10 px-4 py-2":"default"===r,"h-9 rounded-md px-3":"sm"===r,"h-11 rounded-md px-8":"lg"===r,"h-10 w-10":"icon"===r},i),ref:t,...s})});x.displayName="Button";var b=i(7712),v=i(4616);function N(e){var t,i,r,s,l,o;let{product:d,initialConfig:h,onConfigChange:N,onFieldFocusChange:y,splitInfo:w,setSplitLinesHovered:j,quantity:S,onQuantityChange:M}=e,[C,P]=(0,n.useState)(String(null!=(i=h.angle)?i:"")),[F,k]=(0,n.useState)(""),[T,_]=(0,n.useState)(""),[L,R]=(0,n.useState)(String(null!=(r=h.specifiedRadius)?r:"")),[A,E]=(0,n.useState)(String(null!=(s=h.width)?s:"")),[I,z]=(0,n.useState)(null),[O,V]=(0,n.useState)(!1),[D,q]=(0,n.useState)(null),[W,B]=(0,n.useState)(null),[H,U]=(0,n.useState)({}),$=(e,t)=>{let i=parseFloat(t),a={...H};if("specifiedRadius"===e){if(t&&!isNaN(i))if(i<100)a[e]="Radius must be at least 100mm";else{let t=h.radiusType||"internal",n=Number(h.width)||0;"external"===t&&n>0&&n>=i&&(a[e]="External radius must be greater than width")}a[e]||delete a[e]}else if("width"===e){if(t&&!isNaN(i))if(i<=0)a[e]="Width must be greater than 0mm";else if(i>1190)a[e]="Width cannot exceed 1190mm (sheet width)";else{let t=h.radiusType||"internal",n=Number(h.specifiedRadius)||0;"external"===t&&n>0&&i>=n&&(a[e]="Width must be less than external radius")}a[e]||delete a[e]}else"angle"===e&&(t&&!isNaN(i)&&(i<=0||i>=361)?a[e]="Angle must be between 0.1\xb0 and 360\xb0":delete a[e]);U(a)};(0,n.useEffect)(()=>{y&&y(W)},[W,y]),(0,n.useEffect)(()=>{d.parameters.some(e=>"materials"===e.optionsSource)&&(async()=>{V(!0),q(null);try{let e=await fetch("/api/materials");if(!e.ok)throw Error("Failed to fetch materials: ".concat(e.statusText));let t=await e.json();z(t)}catch(t){let e=t instanceof Error?t.message:"Unknown error fetching materials";console.error("Error fetching materials:",e),q(e),z(null)}finally{V(!1)}})()},[d.parameters]),(0,n.useEffect)(()=>{var e,t,i;let a,n;P(String(null!=(e=h.angle)?e:"")),R(String(null!=(t=h.specifiedRadius)?t:"")),E(String(null!=(i=h.width)?i:""));let r=h.radiusType||"internal",s=Number(h.specifiedRadius),l=Number(h.width),o=Number(h.angle);if("internal"===r?(a=s,n=s+l):(n=s,a=s-l),a<0&&(a=0),!isNaN(n)&&n>0&&!isNaN(l)&&l>0&&!isNaN(o)&&o>0){let e,t=Math.PI/180*o,i=n*t;e=o>180?2*n:2*n*Math.sin(t/2),"arcLength"!==W&&k(i>0?i.toFixed(2):""),"chordLength"!==W&&_(e>0?e.toFixed(2):"")}else"arcLength"!==W&&k(""),"chordLength"!==W&&_("")},[h,W]);let G=(0,n.useCallback)((e,t)=>{"angle"===e&&P(t),"arcLength"===e&&k(t),"chordLength"===e&&_(t);let i=parseFloat(t),a=Number(h.specifiedRadius),n=Number(h.width),r=h.radiusType,s=0;if(s="internal"===r?a+n:a,!isNaN(i)&&i>0&&!isNaN(a)&&a>0&&!isNaN(n)&&n>0&&!("external"===r&&a<=n)&&s>0){let t=0,a=!1;try{if("angle"===e&&i<=360&&i>=.1)t=i,a=!0;else if("arcLength"===e){let e=i/s;a=(t=180/Math.PI*e)>=.1&&t<=360}else if("chordLength"===e){let e=2*s;if(i<=e){let e=i/(2*s);if(e<=1&&e>0){let i=2*Math.asin(e);a=(t=180/Math.PI*i)>=.1&&t<=360}}}a&&!isNaN(t)&&N({angle:Number(t.toFixed(6))})}catch(e){}}},[h,N]),Q=(0,n.useCallback)((e,t)=>{let i=parseFloat(t),a=Number(h.specifiedRadius),n=Number(h.width),r=h.radiusType,s=0;s="internal"===r?a+n:a;let l={};if(isNaN(a)||a<=0||isNaN(n)||n<=0||"external"===r&&a<=n||s<=0){let e=Number(h.angle);if(!isNaN(e)&&e>0){P(String(e));let t=Math.PI/180*e,i=s>0?s*t:0,a=0;s>0&&(a=e>180?2*s:2*s*Math.sin(t/2)),i>0&&k(i.toFixed(2)),a>0&&_(a.toFixed(2))}else P(""),k(""),_("");return}let o=Number(h.angle),d=0,c=0,u=!isNaN(i)&&i>0;try{if("angle"===e&&u&&i<=360&&i>=.1){let e=Math.PI/180*i;o=i,d=s*e,c=i>180?2*s:2*s*Math.sin(e/2),!isNaN(d)&&!isNaN(c)&&d>0&&c>0?(P(String(o)),k(d.toFixed(2)),_(c.toFixed(2)),l={angle:Number(o.toFixed(6))}):u=!1}else if("arcLength"===e&&u)if(s>0){let e=i/s;(o=180/Math.PI*e)>=.1&&o<=360?(c=o>180?2*s:2*s*Math.sin(e/2),isNaN(o)||isNaN(c)||!(c>=0)?u=!1:(P(o.toFixed(2)),k(String(i)),_(c.toFixed(2)),l={angle:Number(o.toFixed(6))})):u=!1}else u=!1;else if("chordLength"===e&&u){let e=2*s;if(s>0&&i<=e&&i>0){let e=i/(2*s);if(e<=1&&e>0){let t=2*Math.asin(e);(o=180/Math.PI*t)>=.1&&o<=360?(d=s*t,isNaN(o)||isNaN(d)||!(d>0)?u=!1:(P(o.toFixed(2)),k(d.toFixed(2)),_(String(i)),l={angle:Number(o.toFixed(6))})):u=!1}else u=!1}else u=!1}else{let e=Number(h.angle);if(!isNaN(e)&&e>0){P(String(e));let t=Math.PI/180*e,i=s>0?s*t:0,a=0;s>0&&(a=e>180?2*s:2*s*Math.sin(t/2)),i>0&&k(i.toFixed(2)),a>0&&_(a.toFixed(2))}else P(""),k(""),_(""),N({angle:""});u=!1}u&&Object.keys(l).length>0&&N(l)}catch(t){console.error("Calculation error in handleGeometricInputBlur:",t);let e=Number(h.angle);if(!isNaN(e)&&e>0){P(String(e));let t=Math.PI/180*e,i=s>0?s*t:0,a=0;s>0&&(a=e>180?2*s:2*s*Math.sin(t/2)),i>0&&k(i.toFixed(2)),a>0&&_(a.toFixed(2))}else P(""),k(""),_(""),N({angle:""})}},[h,N]),X=(0,n.useCallback)((e,t)=>{let i,a=d.parameters.find(t=>t.id===e);if(!a)return;let n=String(t),r={};if("radiusType"===e){N(r={[e]:n}),setTimeout(()=>{let e=String(h.specifiedRadius||""),t=String(h.width||"");e&&$("specifiedRadius",e),t&&$("width",t);let i=Number(h.angle);!isNaN(i)&&i>0&&G("angle",String(i))},0);return}if("specifiedRadius"===e){R(n);let t=parseFloat(n);if("number"===a.type){if(!isNaN(t)&&t>=a.min&&(void 0===a.max||t<=a.max))r={[e]:t};else{if(""!==n)return;r={[e]:""}}N(r);let i=Number(h.angle);!isNaN(i)&&i>0&&setTimeout(()=>Q("angle",String(i)),0)}return}if("width"===e){E(n);let t=parseFloat(n);if("number"===a.type){if(!isNaN(t)&&t>=a.min&&(void 0===a.max||t<=a.max))r={[e]:t};else{if(""!==n)return;r={[e]:""}}N(r);let i=Number(h.angle);!isNaN(i)&&i>0&&setTimeout(()=>Q("angle",String(i)),0)}return}if("angle"===e)return void Q("angle",n);if("number"===a.type){let e=parseFloat(n);if(!isNaN(e)&&(void 0===a.min||e>=a.min)&&(void 0===a.max||e<=a.max))i=e;else{if(""!==n)return;i=""}}else i=n;if(void 0!==i){let t=h[e];Object.prototype.hasOwnProperty.call(h,e)?t!==i&&N(r={[e]:i}):N(r={[e]:i})}},[d.parameters,h,N,Q]),Z=(0,n.useMemo)(()=>d.parameters.find(e=>"material"===e.id),[d.parameters]),J=(0,n.useMemo)(()=>d.parameters.find(e=>"radiusType"===e.id),[d.parameters]),K=(0,n.useMemo)(()=>d.parameters.find(e=>"specifiedRadius"===e.id),[d.parameters]),Y=(0,n.useMemo)(()=>d.parameters.find(e=>"width"===e.id),[d.parameters]),ee=(0,n.useMemo)(()=>d.parameters.filter(e=>!["material","radiusType","specifiedRadius","width","angle"].includes(e.id)),[d.parameters]),et=e=>{var t,i,n;if(["specifiedRadius","width","angle","material","radiusType"].includes(e.id))return null;let r={id:e.id},s=(0,a.jsx)(c,{htmlFor:e.id,className:"block mb-2 font-medium text-foreground",children:e.label});switch(e.type){case"number":if(["angle","specifiedRadius","width"].includes(e.id))return null;return(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:e.id,className:"block mb-2 font-medium text-foreground",children:e.label}),(0,a.jsx)(u,{type:"number",id:e.id,value:String(null!=(t=h[e.id])?t:""),onChange:t=>X(e.id,t.target.value),onFocus:()=>B(e.id),onBlur:()=>B(null),min:e.min,max:e.max,step:e.step,className:"w-full [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id);case"button-group":if("radiusType"===e.id)return null;return(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:e.id,className:"block mb-2 font-medium text-foreground",children:e.label}),(0,a.jsx)(f,{type:"single",value:String(null!=(i=h[e.id])?i:""),onValueChange:t=>{t&&X(e.id,t)},className:"justify-start",children:e.options.map(e=>(0,a.jsx)(g,{value:e.value,"aria-label":e.label,children:e.label},e.value))}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id);case"select":{if("material"===e.id)return null;let t=[],i=!1,l=null,o="Select ".concat(e.label,"...");if("materials"===e.optionsSource?O?(i=!0,o="Loading materials..."):D?(l=D,o="Error loading materials"):I?t=I.map(e=>({value:e.id,label:e.name})):o="No materials available":e.options?t=e.options:(o=l="No options defined for ".concat(e.label),console.warn("Select parameter '".concat(e.id,"' has no options defined or sourced."))),i||l)return(0,a.jsxs)("div",{...r,children:[s,(0,a.jsx)(m,{disabled:!0,className:"w-full",children:(0,a.jsx)("option",{value:"",disabled:!0,children:o})}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),l&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:l})]},e.id);return(0,a.jsxs)("div",{...r,children:[s,(0,a.jsxs)(m,{value:String(null!=(n=h[e.id])?n:""),onValueChange:t=>X(e.id,t),className:"w-full",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:o}),t.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]}),e.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id)}default:return(0,a.jsxs)("div",{children:["Unsupported: ",e.type]},e.id)}};return(0,a.jsxs)("div",{className:"space-y-4",children:[Z&&(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:Z.id,className:"block mb-2 font-medium text-foreground",children:Z.label}),(0,a.jsxs)(m,{value:String(null!=(l=h[Z.id])?l:""),onValueChange:e=>X(Z.id,e),disabled:O||!!D||!I,className:"w-full",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:O?"Loading...":D?"Error":"Select Material..."}),null==I?void 0:I.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," \xb7 ",e.thickness_mm,"mm \xb7 ",e.sheet_length_mm,"\xd7",e.sheet_width_mm,"mm \xb7 $",e.sheet_price.toFixed(2)]},e.id))]}),D&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:D}),Z.description&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:Z.description})]}),J&&(0,a.jsxs)("div",{children:[(0,a.jsx)(f,{type:"single",value:String(null!=(o=h[J.id])?o:"internal"),onValueChange:e=>{e&&X(J.id,e)},className:"justify-start",children:null==(t=J.options)?void 0:t.map(e=>(0,a.jsx)(g,{value:e.value,"aria-label":e.label,variant:"outline",children:e.label},e.value))}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Radius: inner or outer edge."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[K&&(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:K.id,className:"block mb-1 font-medium text-foreground",children:"external"===h.radiusType?"Ext. Radius (r)":"Int. Radius (r)"}),(0,a.jsx)(u,{type:"number",id:K.id,value:String(L),onChange:e=>X(K.id,e.target.value),onFocus:()=>{let e={...H};delete e[K.id],U(e),B(K.id)},onBlur:()=>{$(K.id,String(L)),B(null)},placeholder:"mm",min:K.min,step:K.step,className:"w-full [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ".concat(H.specifiedRadius?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),H.specifiedRadius&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:H.specifiedRadius})]}),Y&&(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:Y.id,className:"block mb-1 font-medium text-foreground",children:Y.label}),(0,a.jsx)(u,{type:"number",id:Y.id,value:String(A),onChange:e=>X(Y.id,e.target.value),onFocus:()=>{let e={...H};delete e[Y.id],U(e),B(Y.id)},onBlur:()=>{$(Y.id,String(A)),B(null)},placeholder:"mm",min:Y.min,step:Y.step,className:"w-full [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ".concat(H.width?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),H.width&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:H.width})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:"angle",className:"block mb-1 font-medium text-foreground",children:"Angle (θ)"}),(0,a.jsx)(u,{type:"number",id:"angle",value:C,onChange:e=>G("angle",e.target.value),onBlur:e=>{$("angle",e.target.value),Q("angle",e.target.value),B(null)},onFocus:()=>{let e={...H};delete e.angle,U(e),B("angle")},min:1,max:360,step:.1,placeholder:"degrees",className:"w-full [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield] ".concat(H.angle?"border-red-500 focus:border-red-500 focus:ring-red-500":"")}),H.angle&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:H.angle})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:"arcLength",className:"block mb-1 font-medium text-foreground",children:"Arc Length (L)"}),(0,a.jsx)(u,{type:"number",id:"arcLength",value:F,onChange:e=>G("arcLength",e.target.value),onBlur:e=>{Q("arcLength",e.target.value),B(null)},onFocus:()=>B("arcLength"),min:.01,step:.1,placeholder:"mm",className:"w-full [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:"chordLength",className:"block mb-1 font-medium text-foreground",children:"Chord Length (c)"}),(0,a.jsx)(u,{type:"number",id:"chordLength",value:String(T),onChange:e=>G("chordLength",e.target.value),onBlur:e=>{Q("chordLength",e.target.value),B(null)},onFocus:()=>B("chordLength"),min:.01,step:.1,placeholder:"mm",className:"w-full [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]"})]})]}),(0,a.jsx)("p",{className:"text-sm mt-3 px-2 py-1 rounded transition-all duration-200 ease-in-out ".concat("angle"===W||"arcLength"===W||"chordLength"===W?"text-foreground font-medium bg-blue-100 border-l-2 border-blue-400":"text-muted-foreground"),children:"Input Angle, Arc Length, or Chord Length; others auto-calculate."})]}),ee.filter(e=>e.id!==(null==J?void 0:J.id)).map(e=>(0,a.jsx)("div",{children:et(e)},e.id)),(null==w?void 0:w.isTooLarge)&&(0,a.jsx)("div",{className:"cursor-pointer",onMouseEnter:()=>j(!0),onMouseLeave:()=>j(!1),children:(0,a.jsxs)("div",{className:"border border-orange-400/30 text-orange-600 px-3 py-2 rounded-md flex items-center text-sm shadow-md bg-white",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,a.jsxs)("span",{children:["Part is too large for a single sheet. Will be manufactured in ",w.numSplits," sections."]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(c,{htmlFor:"part-quantity",className:"block mb-1 font-medium text-foreground",children:"Part Quantity"}),(0,a.jsxs)("div",{className:"flex items-center w-fit",children:[(0,a.jsx)(x,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-r-none border-r-0",onClick:()=>M(Math.max(1,S-1)),"aria-label":"Decrease quantity",children:(0,a.jsx)(b.A,{className:"h-4 w-4"})}),(0,a.jsx)(u,{id:"part-quantity",type:"number",value:String(S),onChange:e=>{let t=parseInt(e.target.value,10);M(isNaN(t)||t<1?1:t)},min:1,step:1,className:"h-9 w-16 rounded-none border-x-0 text-center focus-visible:ring-0 focus-visible:ring-offset-0 [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none [-moz-appearance:textfield]","aria-label":"Part quantity"}),(0,a.jsx)(x,{variant:"outline",size:"icon",className:"h-9 w-9 rounded-l-none border-l-0",onClick:()=>M(S+1),"aria-label":"Increase quantity",children:(0,a.jsx)(v.A,{className:"h-4 w-4"})})]})]})]})}var y=i(7558),w=i(9957),j=i(8092),S=i(4688),M=i(3264),C=i(8293),P=i(8979);let F=e=>{let{setTopView:t,resetCamera:i,is3DView:n}=e;return(0,a.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10",children:(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-card p-1 rounded-md shadow-md border border-border",children:[(0,a.jsx)(x,{variant:n?"default":"ghost",size:"sm",onClick:i,title:"3D View (Orbit)",className:"h-8 w-8 p-0",children:(0,a.jsx)(C.A,{className:"h-4 w-4"})}),(0,a.jsx)(x,{variant:n?"ghost":"default",size:"sm",onClick:t,title:"Plan View (Top)",className:"h-8 w-8 p-0",children:(0,a.jsx)(P.A,{className:"h-4 w-4"})})]})})},k=e=>{let{position:t,text:i,color:r="#000000",details:s,isActive:l,onPointerOver:o,onPointerOut:d}=e,[c,u]=(0,n.useState)(!1),m=(c||l)&&s,h=c||l;return(0,a.jsx)(w.E,{position:t,center:!0,children:(0,a.jsxs)("div",{style:{backgroundColor:h?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.7)",padding:"2px 4px",borderRadius:"3px",fontSize:h?"14px":"12px",fontWeight:"bold",color:r,border:h?"1px solid ".concat(r):"none",cursor:"pointer",boxShadow:h?"0 2px 5px rgba(0,0,0,0.2)":"none",transition:"all 0.2s ease"},onPointerOver:e=>{u(!0),null==o||o(e)},onPointerOut:e=>{u(!1),null==d||d(e)},children:[i,m&&(0,a.jsx)("div",{style:{fontSize:"12px",marginTop:"3px",fontWeight:"normal",color:"#555",maxWidth:"150px"},children:s})]})})},T=e=>{let{points:t,color:i,lineWidth:n,dashed:r=!1,dashSize:s=0,gapSize:l=0,dashScale:o=1,onHover:d,isHovered:c,isFieldActive:u,isFlashing:m=!1}=e,h=c||u;return(0,a.jsx)(j.N,{points:t,color:m?"#FF6B6B":h?i:"#888888",lineWidth:m?2.5*n:h?1.5*n:n,dashed:r,dashSize:s,dashScale:o,gapSize:l,onPointerOver:e=>{e.stopPropagation(),d(!0)},onPointerOut:e=>{e.stopPropagation(),d(!1)}})},_=e=>{let{radius:t,width:i,angle:r,thickness:s,arcLength:l,chordLength:o,showDimensions:d,isPlaceholderMode:c,activeFieldHighlight:u,scaleFactor:m,isTooLarge:h,numSplits:f,splitLinesHovered:g,radiusType:p="internal"}=e,[x,b]=(0,n.useState)(!1),[v,N]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!1),[S,C]=(0,n.useState)(!1),[P,F]=(0,n.useState)(!1),[_,L]=(0,n.useState)(!1),[R,A]=(0,n.useState)(!1),E=(0,n.useRef)(p);(0,n.useEffect)(()=>{if(E.current!==p){L(!0),A(!0);let e=0,t=setInterval(()=>{e++,A(e=>!e),e>=6&&(clearInterval(t),L(!1),A(!1))},150);return E.current=p,()=>clearInterval(t)}},[p]);let I=t*m,z=i*m,O=l||0,V=o||0,D=(0,n.useMemo)(()=>{let e=new M.ypk,a=t+i,n=r*Math.PI/180,s=Math.max(64,Math.ceil(2*r));e.moveTo(t,0),e.lineTo(a,0);for(let t=1;t<=s;t++){let i=t/s*n,r=a*Math.cos(i),l=a*Math.sin(i);e.lineTo(r,l)}e.lineTo(t*Math.cos(n),t*Math.sin(n));for(let i=s-1;i>=1;i--){let a=i/s*n,r=t*Math.cos(a),l=t*Math.sin(a);e.lineTo(r,l)}return e.closePath(),e},[t,i,r]),q=(0,n.useMemo)(()=>({steps:1,depth:s,bevelEnabled:!1}),[s]),{geometry:W,centerOffset:B}=(0,n.useMemo)(()=>{let e=new M.QCA(D,q);e.computeBoundingBox();let t=e.boundingBox,i=(t.min.x+t.max.x)/2,a=(t.min.y+t.max.y)/2;return e.translate(-i,-a,0),{geometry:e,centerOffset:new M.Pq0(-i,-a,0)}},[D,q]),H=(0,n.useMemo)(()=>new M.TDQ(W),[W]),U=r*Math.PI/180,$=t+i,G="external"===p?$:t,Q=20/m,X=[[B.x,B.y,Q],[G+B.x,B.y,Q]],Z=[[B.x,B.y,Q],[G*Math.cos(U)+B.x,G*Math.sin(U)+B.y,Q]],J=[[t+B.x,B.y,Q],[$+B.x,B.y,Q]],K=(0,n.useMemo)(()=>{let e=[],t=Math.max(32,Math.ceil(r/2)),i=.15*G;for(let a=0;a<=t;a++){let n=a/t*U;e.push(new M.Pq0(i*Math.cos(n)+B.x,i*Math.sin(n)+B.y,Q))}return e},[G,U,B,Q,r]),Y=[new M.Pq0(G+B.x,B.y,Q),new M.Pq0(G*Math.cos(U)+B.x,G*Math.sin(U)+B.y,Q)],ee=(0,n.useMemo)(()=>{let e=[],t=Math.max(48,Math.ceil(r/2));for(let i=0;i<=t;i++){let a=i/t*U;e.push(new M.Pq0(G*Math.cos(a)+B.x,G*Math.sin(a)+B.y,Q))}return e},[U,r,B,Q,G]),[et,ei]=(0,n.useState)(!1),ea=(0,n.useMemo)(()=>(0,a.jsx)("meshStandardMaterial",{color:c?"#F9F9F9":et?"#E8D0AA":"#D2B48C",side:M.$EB,flatShading:!1,roughness:.75,metalness:.1}),[et,c]);return(0,a.jsxs)("group",{rotation:[-Math.PI/2,0,0],children:[" ",(0,a.jsx)("mesh",{geometry:W,castShadow:!0,receiveShadow:!0,position:[0,0,0],onPointerOver:()=>ei(!0),onPointerOut:()=>ei(!1),children:ea}),(0,a.jsx)("lineSegments",{geometry:H,renderOrder:1,children:(0,a.jsx)("lineBasicMaterial",{color:c?"#A0A0A0":"#654321",linewidth:2})}),d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T,{points:X.map(e=>new M.Pq0(e[0],e[1],e[2])),color:"blue",lineWidth:1,onHover:b,isHovered:x,isFieldActive:"specifiedRadius"===u,isFlashing:_&&R}),(0,a.jsx)(T,{points:Z.map(e=>new M.Pq0(e[0],e[1],e[2])),color:"blue",lineWidth:1,onHover:b,isHovered:x,isFieldActive:"specifiedRadius"===u,isFlashing:_&&R}),(0,a.jsx)(k,{position:[.5*G+B.x,B.y,Q],text:c?"r:":"r: ".concat(Math.round(I),"mm"),color:"blue",details:"".concat("external"===p?"External":"Internal"," dimensions"),onPointerOver:()=>b(!0),onPointerOut:()=>b(!1),isActive:"specifiedRadius"===u}),(0,a.jsx)(T,{points:J.map(e=>new M.Pq0(e[0],e[1],e[2])),color:"green",lineWidth:1,onHover:N,isHovered:v,isFieldActive:"width"===u}),(0,a.jsx)(k,{position:[t+.5*i+B.x,B.y,Q],text:c?"w:":"w: ".concat(Math.round(z),"mm"),color:"green",details:"Curve width",onPointerOver:()=>N(!0),onPointerOut:()=>N(!1),isActive:"width"===u}),(0,a.jsx)(T,{points:K,color:"red",lineWidth:1,onHover:w,isHovered:y,isFieldActive:"angle"===u}),(0,a.jsx)(k,{position:[.1*G+B.x,.1*G+B.y,Q],text:c?"θ:":"θ: ".concat(r,"\xb0"),color:"red",details:"Angle",onPointerOver:()=>w(!0),onPointerOut:()=>w(!1),isActive:"angle"===u}),(c||l)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T,{points:ee,color:"#8844AA",lineWidth:1,onHover:C,isHovered:S,isFieldActive:"arcLength"===u,isFlashing:_&&R}),(0,a.jsx)(k,{position:[G*Math.cos(.5*U)+B.x,G*Math.sin(.5*U)+B.y,Q],text:c?"L:":"L: ".concat(Math.round(O),"mm"),color:"#8844AA",details:"Arc length",onPointerOver:()=>C(!0),onPointerOut:()=>C(!1),isActive:"arcLength"===u})]}),(c||o)&&(0,a.jsx)(T,{points:Y,color:"orange",lineWidth:1,dashed:!0,dashSize:.05,dashScale:1,gapSize:.05,onHover:F,isHovered:P,isFieldActive:"chordLength"===u}),(c||o)&&(0,a.jsx)(k,{position:[.7*G*Math.cos(.5*U)+B.x,.7*G*Math.sin(.5*U)+B.y,Q],text:c?"c:":"c: ".concat(Math.round(V),"mm"),color:"orange",details:"Chord length",onPointerOver:()=>F(!0),onPointerOut:()=>F(!1),isActive:"chordLength"===u}),!c&&h&&f&&f>1&&(0,a.jsx)(a.Fragment,{children:Array.from({length:f-1}).map((e,i)=>{let n=r/f*(i+1)*Math.PI/180,s=new M.Pq0(t*Math.cos(n)+B.x,t*Math.sin(n)+B.y,Q),l=new M.Pq0($*Math.cos(n)+B.x,$*Math.sin(n)+B.y,Q);return(0,a.jsx)(j.N,{points:[s,l],color:g?"orange":"red",lineWidth:g?5:3},"split-".concat(i))})})]})]})},L=e=>{let{radius:t=1200,width:i=100,angle:r=90,materialThickness:s=18,arcLength:l,chordLength:o,showDimensions:d=!1,isPlaceholderMode:c=!1,activeFieldHighlight:u,isTooLarge:m=!1,numSplits:h=1,splitLinesHovered:f=!1,radiusType:g="internal"}=e,p=(0,n.useRef)(null),[x,b]=(0,n.useState)(!1),v=(0,n.useRef)({radius:t,width:i,angle:r,materialThickness:s}),N=t/500,w=i/500,j=s/500,C=(0,n.useMemo)(()=>{let e=t+i;return Math.max(e,e*Math.sin(r*Math.PI/180))/500*(r>180?1.1:1.05)},[t,i,r,500]),P=(0,n.useCallback)((e,t,i)=>{let a=1.8;return e>2e3&&(a+=.15*Math.floor((e-2e3)/1e3)),i<30?a=Math.max(a,1.8):i>180?a=Math.max(a,2.2):(t>0?e/t:1/0)>20&&(a=Math.max(a,2)),Math.min(a,5)},[]),k=(0,n.useMemo)(()=>P(t,i,r),[t,i,r,P]);(0,n.useEffect)(()=>{v.current.radius===t&&v.current.width===i&&v.current.angle===r&&v.current.materialThickness===s||x||(v.current={radius:t,width:i,angle:r,materialThickness:s})},[t,i,r,s,x]);let T=(0,n.useCallback)(()=>{if(p.current){let e=p.current.object,t=1.5*C;e.position.set(.6*t,.4*t,.6*t),p.current.target.set(0,0,0),p.current.update(),b(!0)}},[C]),L=(0,n.useCallback)(()=>{if(p.current){p.current.reset(),p.current.update(),p.current.setAzimuthalAngle(0),p.current.setPolarAngle(0);let e=p.current.object;if(e instanceof M.ubm){let a=P(t,i,r);e.position.set(0,C*a,0),e.updateProjectionMatrix()}p.current.update(),b(!1)}},[C,t,i,r,P]);return(0,n.useEffect)(()=>{setTimeout(()=>{L()},100)},[L]),(0,n.useEffect)(()=>{x||L()},[t,i,r,L,x]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(y.Hl,{shadows:!0,camera:{position:[0,C*k,0],fov:45},style:{background:"#ffffff",width:"100%",height:"100%"},children:[(0,a.jsx)("ambientLight",{intensity:.7})," ",(0,a.jsx)("directionalLight",{position:[8,12,8],intensity:.9,castShadow:!0,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,"shadow-camera-near":.1,"shadow-camera-far":50,"shadow-camera-left":-10,"shadow-camera-right":10,"shadow-camera-top":10,"shadow-camera-bottom":-10,"shadow-bias":-.001}),(0,a.jsx)("directionalLight",{position:[-5,5,-5],intensity:.3}),(0,a.jsx)(_,{radius:N,width:w,angle:r,thickness:j,arcLength:l,chordLength:o,showDimensions:d,isPlaceholderMode:c,activeFieldHighlight:u,scaleFactor:500,isTooLarge:m,numSplits:h,splitLinesHovered:f,radiusType:g}),(0,a.jsx)(S.N,{ref:p,enableDamping:!0,dampingFactor:.1,minDistance:.1,maxDistance:100,target:[0,0,0],makeDefault:!0,enableRotate:x,maxPolarAngle:Math.PI/2})]}),(0,a.jsx)(F,{resetCamera:T,setTopView:L,is3DView:x})]})};var R=i(9103),A=i(2525),E=i(2711),I=i(4416),z=i(133);let O=n.forwardRef((e,t)=>{let{className:i,orientation:n="horizontal",decorative:r=!0,...s}=e;return(0,a.jsx)("div",{ref:t,role:r?"none":"separator","aria-orientation":n,className:o("shrink-0 bg-gray-200","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",i),...s})});O.displayName="Separator";let V=n.forwardRef((e,t)=>{let{className:i,children:n,...r}=e;return(0,a.jsx)("div",{ref:t,className:o("overflow-auto",i),...r,children:n})});V.displayName="ScrollArea";let D={business:{gstRate:.1,manufactureRate:88,manufactureAreaRate:22,defaultEfficiency:.5,maxSplits:10,shopifyVariantId:0x29335f9000b2},materials:[{id:"form-17",name:"Formply",type:"Structural Plywood",thickness_mm:17,sheet_price:82.5,rate_per_m2:55,sheet_length_mm:2400,sheet_width_mm:1200,usable_sheet_length_mm:2390,usable_sheet_width_mm:1190,sheet_area_m2:2.88},{id:"mdf-18",name:"MDF Standard",type:"Wood Composite",thickness_mm:18,sheet_price:57.02,rate_per_m2:71.5,sheet_length_mm:2400,sheet_width_mm:1200,usable_sheet_length_mm:2390,usable_sheet_width_mm:1190,sheet_area_m2:2.88},{id:"CD-19",name:"CD Structural Plywood",type:"Structural Plywood",thickness_mm:19,sheet_price:102.96,rate_per_m2:93.5,sheet_length_mm:2400,sheet_width_mm:1200,usable_sheet_length_mm:2390,usable_sheet_width_mm:1190,sheet_area_m2:2.88}],efficiency:{referenceWidth:100,widthAdjustmentSensitivity:.5,minWidthAdjustmentFactor:.7,maxWidthAdjustmentFactor:1.3,minEfficiency:.05,maxEfficiency:.95,defaultEfficiency:.3,dataPoints:[{radius:200,angle:90,width:100,efficiency:.65},{radius:400,angle:90,width:100,efficiency:.58},{radius:600,angle:90,width:100,efficiency:.42},{radius:800,angle:90,width:100,efficiency:.44},{radius:1e3,angle:90,width:100,efficiency:.38},{radius:1200,angle:90,width:100,efficiency:.34},{radius:1400,angle:90,width:100,efficiency:.39},{radius:1600,angle:90,width:100,efficiency:.25},{radius:200,angle:180,width:100,efficiency:.3},{radius:400,angle:180,width:100,efficiency:.37},{radius:600,angle:180,width:100,efficiency:.2},{radius:800,angle:180,width:100,efficiency:.18}]},ui:{visualizer:{svgViewSize:400,svgPadding:25,scaleFactor:500,defaultDimensions:{radius:900,width:100,angle:90,thickness:18}},placeholders:{radius:"mm",width:"mm",angle:"deg",arcLength:"mm",chordLength:"mm",qty:""}}};D.materials.reduce((e,t)=>(e[t.thickness_mm.toString()]=t.rate_per_m2,e),{}),D.business.gstRate,D.business.shopifyVariantId;let q=D.business.defaultEfficiency,W=D.business.manufactureRate,B=D.business.manufactureAreaRate;D.ui.visualizer.svgViewSize,D.ui.visualizer.svgPadding,D.ui.visualizer.defaultDimensions,D.ui.placeholders,D.efficiency.dataPoints;let H=D.efficiency.dataPoints;function U(e,t,i){let a,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H,{minEfficiency:r,maxEfficiency:s,defaultEfficiency:l,referenceWidth:o,widthAdjustmentSensitivity:c,minWidthAdjustmentFactor:u,maxWidthAdjustmentFactor:m}=D.efficiency;if(!d.isValidPositiveNumber(e)||!d.isValidPositiveNumber(t)||!d.isValidAngle(i))return console.warn("Invalid input parameters for efficiency calculation: radius=".concat(e,", width=").concat(t,", angle=").concat(i)),l;if(!n||0===n.length)return console.warn("Empty or invalid efficiency dataset provided"),l;let h=n.filter(e=>d.isValidPositiveNumber(e.radius)&&d.isValidAngle(e.angle)&&d.isValidPositiveNumber(e.width)&&d.isValidEfficiency(e.efficiency)&&e.angle===i);if(0===h.length)console.warn("No valid efficiency data found for angle: ".concat(i," degrees. Using default efficiency.")),a=l;else{h.sort((e,t)=>e.radius-t.radius);let t=h.find(t=>t.radius===e);a=t?t.efficiency:1===h.length?h[0].efficiency:d.safeCalculate(()=>{if(e<h[0].radius){let t=h[0].radius,i=h[0].efficiency,a=h[1].radius,n=h[1].efficiency;return a===t?i:i+(e-t)*(n-i)/(a-t)}if(e>h[h.length-1].radius){let t=h[h.length-2].radius,i=h[h.length-2].efficiency,a=h[h.length-1].radius,n=h[h.length-1].efficiency;return a===t?n:i+(e-t)*(n-i)/(a-t)}{for(let t=0;t<h.length-1;t++)if(e>=h[t].radius&&e<=h[t+1].radius){let i=h[t].radius,a=h[t].efficiency,n=h[t+1].radius,r=h[t+1].efficiency;if(n===i)return a;return a+(e-i)*(r-a)/(n-i)}let t=h[0],i=Math.abs(e-t.radius);for(let a=1;a<h.length;a++){let n=Math.abs(e-h[a].radius);n<i&&(i=n,t=h[a])}return t.efficiency}},l)}d.isValidEfficiency(a)||(console.warn("Invalid base efficiency calculated: ".concat(a,". Using default.")),a=l),a=d.clamp(a,r,s);let f=1;o>0&&t>0?(f=1-c*(d.safeDivide(t,o,1)-1),f=d.clamp(f,u,m)):console.warn("Invalid width parameters for adjustment: actualWidth=".concat(t,", referenceWidth=").concat(o));let g=a*f;return(g=d.clamp(g,r,s),d.isValidEfficiency(g))?g:(console.error("Final efficiency calculation failed for radius=".concat(e,", angle=").concat(i,", width=").concat(t,". Returning default.")),l)}let $=e=>{let t,i,a=Number(e.config.specifiedRadius),n=Number(e.config.width),r=Number(e.config.angle);"internal"===e.config.radiusType?(t=a,i="R"):(t=a-n,i="R(int)"),t=Math.max(0,t);let s="".concat(i,":").concat(t," W:").concat(n," A:").concat(r,"\xb0");return{internalRadius:t,displayString:s}},G="internal",Q=()=>({material:"form-17",radiusType:"internal",specifiedRadius:"",width:"",angle:""}),X=()=>(console.log("Current hostname:",window.location.hostname),"/craftons-curves-calculator"),Z=()=>{let[e,t]=(0,n.useState)(null),[i,s]=(0,n.useState)(Q()),[l,o]=(0,n.useState)(!0),[d,c]=(0,n.useState)(null),[u,m]=(0,n.useState)(null),[h,f]=(0,n.useState)([]),[g,b]=(0,n.useState)(1),[v,y]=(0,n.useState)(null),[w,j]=(0,n.useState)(null),[S,M]=(0,n.useState)(!0),[C,P]=(0,n.useState)({isTooLarge:!1,numSplits:1}),[F,k]=(0,n.useState)(!1),[T,_]=(0,n.useState)(null),[D,Z]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{o(!0),c(null),t(null),y(null),j(null);try{let e=X(),i="".concat(e,"/api/products/curves.json");console.log("[CurvesCustomizer] Fetching product from URL:",i);let a=await fetch(i);if(console.log("[CurvesCustomizer] Product fetch response status:",a.status),!a.ok)throw Error("Failed to fetch product: ".concat(a.statusText," (Status: ").concat(a.status,")"));let n=await a.json();console.log("[CurvesCustomizer] Product loaded successfully"),t(n);let r=Q();n.parameters.forEach(e=>{Object.prototype.hasOwnProperty.call(r,e.id)&&void 0!==r[e.id]||(r[e.id]=void 0!==e.defaultValue?e.defaultValue:"")}),s(r),b(1)}catch(e){console.error("Failed to load Curves product data:",e),c(e instanceof Error?e.message:"Failed to load configuration data."),t(null),s(Q()),m(null),y(null),j(null)}finally{o(!1)}})()},[]),(0,n.useEffect)(()=>{let e=async()=>{try{let e=X(),t="".concat(e,"/api/materials.json");console.log("[CurvesCustomizer] Fetching materials from URL:",t);let i=await fetch(t);if(console.log("[CurvesCustomizer] Materials fetch response status:",i.status),!i.ok)throw Error("Failed to fetch materials: ".concat(i.statusText," (Status: ").concat(i.status,")"));let a=await i.json();console.log("[CurvesCustomizer] Materials loaded successfully:",a.length,"materials"),m(a)}catch(e){console.error("[CurvesCustomizer] Error fetching materials:",e instanceof Error?e.message:"Unknown error fetching materials"),console.error("[CurvesCustomizer] Full error:",e),m(null)}};d||e()},[d,e]);let J=!(i.material&&""!==i.material&&i.radiusType&&("internal"===i.radiusType||"external"===i.radiusType)&&Number(i.specifiedRadius)>0&&Number(i.width)>0&&Number(i.angle)>0),{actualInnerRadius:K,actualOuterRadius:Y}=(()=>{let e=i.radiusType&&("internal"===i.radiusType||"external"===i.radiusType)?i.radiusType:G,t=Number(i.specifiedRadius),a=!isNaN(t)&&t>0?t:900,n=Number(i.width),r=!isNaN(n)&&n>0?n:100,s=0,l=0;return"internal"===e?(s=a,l=a+r):(l=a,s=a-r),s<0&&(s=0),{actualInnerRadius:s,actualOuterRadius:l}})(),ee=Number(i.angle),et=!isNaN(ee)&&ee>0?ee:90;(0,n.useEffect)(()=>{let e,t,a=Number(et);if(isNaN(Y)||Y<=0||isNaN(a)||a<=0||a>360||J||!i.material||!u||0===u.length)return void P({isTooLarge:!1,numSplits:1});let n=u.find(e=>e.id===i.material);if(!n||!n.sheet_length_mm||!n.sheet_width_mm||n.sheet_length_mm<=0||n.sheet_width_mm<=0){console.warn("Invalid material data for ID: ".concat(i.material,". Defaulting to no split.")),P({isTooLarge:!1,numSplits:1});return}let r=n.sheet_length_mm,s=n.sheet_width_mm,l=Number(i.width);if(isNaN(l)||l<=0)return void P({isTooLarge:!1,numSplits:1});let o=Math.min(r,s),d=Math.max(r,s);if(l<=o)e=d;else if(l<=d)e=o;else{console.warn("Part width (".concat(l,"mm) exceeds maximum sheet dimension (").concat(d,"mm)")),P({isTooLarge:!0,numSplits:1});return}if(e<=0){console.error("Invalid available sheet length calculated: ".concat(e,"mm")),P({isTooLarge:!1,numSplits:1});return}let c=Math.PI/180*a;if((a>180?2*Y:2*Y*Math.sin(c/2))<=e)P({isTooLarge:!1,numSplits:1});else{let t,i=e/(2*Y);if(i>=1)return void P({isTooLarge:!1,numSplits:1});if(i<=0){console.warn("Radius ".concat(Y,"mm is too large for sheet ").concat(e,"mm")),P({isTooLarge:!0,numSplits:10});return}let n=Math.ceil(a/(180/Math.PI*(2*Math.asin(i)))),r=a/(n=Math.max(2,Math.min(n,20)));(t=r>180?2*Y:2*Y*Math.sin(r*Math.PI/180/2))>e&&(console.warn("Split calculation insufficient. Split chord: ".concat(t.toFixed(2),"mm, Available: ").concat(e,"mm. Need more splits.")),n=Math.min(20,n+1)),P({isTooLarge:!0,numSplits:n})}},[Y,et,i.material,i.width,u,J]),(0,n.useEffect)(()=>{if(0===h.length||!u){y(null),j(null);return}try{let e=0,t=0,i=0,a={},n={};for(let i in h.forEach(e=>{let t=e.config.material;n[t]||(n[t]=[]),n[t].push(e)}),n){let r=n[i],s=u.find(e=>e.id===i);if(!s){console.error("Material details not found for ID: ".concat(i,". Skipping group."));continue}let l=0,o=0;r.forEach(e=>{let t=e.itemIdealEfficiency;if(e.numSplits>1){let i=Number(e.config.angle)/e.numSplits,a="external"===e.config.radiusType?Number(e.config.specifiedRadius):Number(e.config.specifiedRadius)+Number(e.config.width),n=0,r=1;a>=5e3?r=1.4:a>=3e3?r=1.3:a>=1500?r=1.2:a>=800&&(r=1.1),n=i<=15?.3*r:i<=25?.25*r:i<=40?.2*r:i<=60?.15*r:i<=90?.1*r:.05*r;let s=1;e.numSplits>=15?s=1.08:e.numSplits>=10?s=1.05:e.numSplits>=6&&(s=1.02),t=e.itemIdealEfficiency+n*s,t=Math.min(.7,t),e.numSplits>5&&console.log("Efficiency Test - R:".concat(a," Splits:").concat(e.numSplits," AnglePerSplit:").concat(i.toFixed(1),"\xb0 → Efficiency:").concat((100*t).toFixed(1),"%"))}let i=e.singlePartAreaM2*e.numSplits*e.quantity;l+=i*t,o+=i});let d=q;o>0&&!isNaN(l)?(d=l/o,d=Math.max(.05,Math.min(.85,d))):o<=0&&(console.warn("Zero total area for material group ".concat(i,". Using default efficiency.")),d=q),isNaN(d)&&(console.error("NaN calculated for group efficiency (Material: ".concat(i,"). Using fallback.")),d=q);let c=s.sheet_length_mm/1e3*(s.sheet_width_mm/1e3),m=c>0?c:2.88,h=o>0&&m>0&&d>0?Math.ceil(o/(m*d)):0;a[i]=h;let f=h*s.sheet_price,g=W*h+o*B;e+=f,t+=g}let r=Object.values(a).reduce((e,t)=>e+t,0);i=r<=5?2:r<=15?3:r<=40?5:7;let s=h.reduce((e,t)=>e+t.numSplits*t.quantity,0),l=h.length>1&&S?1.5*s:0,o=e+t+l;y({materialCost:e,manufactureCost:t,partIdEngravingCost:l,totalIncGST:o,sheetsByMaterial:a,totalPartCount:s}),j(i)}catch(e){console.error("Error during total price calculation:",e),y(null),j(null)}},[h,u,S]);let ei=(0,n.useCallback)(e=>{s(t=>{let i={...t};for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let a=e[t];void 0!==a&&(i[t]=a)}return i})},[]),ea=(0,n.useCallback)(e=>{_(e),null!==e&&null!==D&&Z(null)},[D]),en=(0,n.useCallback)(e=>{b(Math.max(1,e))},[]),er=(0,n.useCallback)(()=>{let t=Number(i.specifiedRadius),a=Number(i.width),n=Number(i.angle),l=i.radiusType;if(J||a<=0||t<=0||n<=0||n>360||"external"===l&&t<=a)return void console.error("Cannot add part: Invalid configuration detected.");let o=C.isTooLarge?C.numSplits:1;if(o<=0||isNaN(o))return void console.error("Cannot add part: Invalid split information.");let d=0,c=.3;try{let t=n/360*Math.PI*(Math.pow(Y,2)-Math.pow(K,2));if(isNaN(t)||t<=0)return void console.error("Cannot add part: Invalid area calculation.");if(o<=1)d=t/1e6,c=U(K,a,n,H);else{let e=n/o;if(e<=0||e>360)return void console.error("Cannot add part: Invalid split angle calculation.");d=t/o/1e6,c=U(K,a,e,H)}if(isNaN(d)||d<=0)return void console.error("Cannot add part: Final area validation failed.");(isNaN(c)||c<=0)&&(console.warn("Calculated ideal efficiency is invalid, using default 0.3"),c=.3),c=Math.max(.05,Math.min(.95,c));let l={id:(0,r.A)(),partType:"curve",config:{...i},quantity:g,singlePartAreaM2:d,numSplits:o,itemIdealEfficiency:c,priceDetails:{materialCost:0,manufactureCost:0,totalIncGST:0},turnaround:1};if(f(e=>[...e,l]),e){let t=Q();e.parameters.forEach(e=>{Object.prototype.hasOwnProperty.call(t,e.id)&&void 0!==t[e.id]||(t[e.id]=void 0!==e.defaultValue?e.defaultValue:"")}),t.material="form-17",s(t)}else s(Q());b(1)}catch(e){console.error("Error calculating part area:",e);return}},[i,g,C,e,J,K,Y]),es=(0,n.useCallback)(e=>{f(t=>t.filter(t=>t.id!==e)),D===e&&Z(null)},[D]),el=(0,n.useCallback)(async()=>{if(!v||0===h.length)return void alert("No parts to checkout!");try{console.log("Proceeding to Checkout with 1 Cent Rule:"),console.log("Parts:",h),console.log("Totals:",v);let e=Math.round(100*v.totalIncGST),t=h.map((e,t)=>{let i=null==u?void 0:u.find(t=>t.id===e.config.material),{displayString:a}=$(e);return"Part ".concat(t+1,": ").concat(a," - ").concat((null==i?void 0:i.name)||"Unknown"," - Qty: ").concat(e.quantity).concat(e.numSplits>1?" (".concat(e.numSplits," splits)"):"")}).join("\n"),i={"Order Summary":"Craftons Curves Order - ".concat(h.length," unique part").concat(1!==h.length?"s":""),"Total Parts":"".concat(v.totalPartCount," pieces"),Materials:Object.entries(v.sheetsByMaterial).map(e=>{let[t,i]=e,a=null==u?void 0:u.find(e=>e.id===t);return"".concat((null==a?void 0:a.name)||t,": ").concat(i," sheet").concat(1!==i?"s":"")}).join(", "),"Part Details":t,"Material Cost":"$".concat(v.materialCost.toFixed(2)),"Manufacturing Cost":"$".concat(v.manufactureCost.toFixed(2)),"Engraving Cost":v.partIdEngravingCost>0?"$".concat(v.partIdEngravingCost.toFixed(2)):"None",Turnaround:"".concat(w||"TBD"," business days"),"Order Date":new Date().toISOString(),"Pricing Method":"1 Cent Rule - Quantity represents total price in cents"},a=new URLSearchParams;a.append("items[0][id]","45300623343794"),a.append("items[0][quantity]",e.toString()),Object.entries(i).forEach((e,t)=>{let[i,n]=e;a.append("items[0][properties][".concat(i,"]"),n)});let n="https://".concat("craftons-au.myshopify.com","/cart/add?").concat(a.toString());console.log("Adding to cart using 1 cent rule:",{variantId:0x29335f9000b2,quantity:e,totalPrice:v.totalIncGST,cartUrl:n}),window.open(n,"_blank"),alert("Order added to cart successfully!\nTotal: $".concat(v.totalIncGST.toFixed(2),"\nQuantity: ").concat(e," \xd7 $0.01"))}catch(e){console.error("Checkout error:",e),alert("There was an error processing your checkout. Please try again.")}},[h,v,u,w]),eo=(0,n.useCallback)(()=>{if(e){let t=Q();e.parameters.forEach(e=>{Object.prototype.hasOwnProperty.call(t,e.id)&&void 0!==t[e.id]||(t[e.id]=void 0!==e.defaultValue?e.defaultValue:"")}),t.material="form-17",s(t)}else s(Q());b(1),f([]),y(null),j(null),Z(null),M(!0)},[e]),ed=D?h.find(e=>e.id===D):null,ec=ed?ed.config:i,eu=!!ed,{displayInnerRadius:em,displayOuterRadius:eh}=(()=>{let e=ec.radiusType&&("internal"===ec.radiusType||"external"===ec.radiusType)?ec.radiusType:G,t=Number(ec.specifiedRadius),i=!isNaN(t)&&t>0?t:900,a=Number(ec.width),n=!isNaN(a)&&a>0?a:100,r=0,s=0;return"internal"===e?(r=i,s=i+n):(s=i,r=i-n),r<0&&(r=0),{displayInnerRadius:r,displayOuterRadius:s}})(),ef=Number(ec.width),eg=!isNaN(ef)&&ef>0?ef:100,ep=Number(ec.angle),ex=!isNaN(ep)&&ep>0?ep:90,eb=18,ev=ec.material;if(u&&ev&&""!==ev){let e=u.find(e=>e.id===ev);e&&(eb=e.thickness_mm)}let eN=(0,n.useMemo)(()=>{let e;if(isNaN(eh)||eh<=0||isNaN(ex)||ex<=0||ex>360)return{arcLength:0,chordLength:0};let t=Math.PI/180*ex,i=eh*t;return(e=ex>180?2*eh:2*eh*Math.sin(t/2),isNaN(i)||isNaN(e)||i<=0||e<=0)?{arcLength:0,chordLength:0}:{arcLength:i,chordLength:e}},[eh,ex]),ey=(0,n.useMemo)(()=>eu?{isTooLarge:ed.numSplits>1,numSplits:ed.numSplits}:C,[eu,ed,C]);return l&&!e?(0,a.jsx)("div",{className:"p-8 text-center",children:"Loading Curves configuration..."}):d&&!e?(0,a.jsxs)("div",{className:"p-8 text-center text-red-500",children:["Error: ",d]}):e?(0,a.jsx)("div",{className:"flex h-screen max-h-screen flex-col text-foreground overflow-hidden bg-white",children:(0,a.jsxs)("div",{className:"flex flex-1 gap-1 md:flex-row-reverse flex-col overflow-hidden px-4 md:px-8 py-4",children:[(0,a.jsx)("aside",{className:"w-full md:w-[30rem] lg:w-[36rem] flex-shrink-0 h-[40vh] md:h-auto",children:(0,a.jsx)(V,{className:"h-full",children:(0,a.jsxs)("div",{className:"space-y-4 px-4 pb-4",children:[(0,a.jsxs)("div",{className:"rounded-md border border-gray-200 bg-card p-4 space-y-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-1",children:"Configure New Part"}),l&&!e?(0,a.jsx)("div",{children:"Loading form..."}):e?(0,a.jsx)(N,{product:e,initialConfig:i,onConfigChange:ei,onFieldFocusChange:ea,splitInfo:C,setSplitLinesHovered:k,quantity:g,onQuantityChange:en}):(0,a.jsx)("div",{children:"Could not load product definition for the form."}),(0,a.jsxs)(x,{onClick:er,disabled:l||!!d||J,className:"w-full mt-3 bg-slate-800 hover:bg-slate-700 text-white",size:"lg",children:[(0,a.jsx)(R.A,{className:"mr-2 h-4 w-4"}),"Add Part to Sheet"]})]}),(0,a.jsxs)("div",{className:"rounded-md border border-gray-200 bg-card p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Parts Added to Sheet"}),0===h.length?(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No parts added yet."}):(0,a.jsx)("ul",{className:"space-y-2",children:h.map((e,t)=>{let{displayString:i}=$(e);return(0,a.jsxs)("li",{className:"flex justify-between items-center text-sm border-b border-dashed border-gray-200 pb-1",children:[(0,a.jsxs)("span",{className:"cursor-pointer transition-colors duration-200 flex-1 ".concat(D===e.id?"text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded":"hover:text-blue-500 hover:bg-gray-50 px-2 py-1 rounded"),onClick:()=>Z(D===e.id?null:e.id),title:"Click to view in visualizer",children:["".concat(t+1,". ").concat(i," (Qty: ").concat(e.quantity,")"),e.numSplits>1&&(0,a.jsxs)("span",{className:"text-xs text-orange-500 ml-1",children:["(Split x",e.numSplits,")"]})]}),(0,a.jsx)(x,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>es(e.id),children:(0,a.jsx)(A.A,{className:"h-4 w-4 text-destructive"})})]},e.id)})})]}),(0,a.jsx)(O,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Order Summary"}),v?(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[Object.entries(v.sheetsByMaterial).map(e=>{var t;let[i,n]=e;return(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,a.jsx)(E.A,{className:"h-4 w-4 mr-2"}),(null==u||null==(t=u.find(e=>e.id===i))?void 0:t.name)||i," (",n," sheet",1!==n?"s":"",")"]})},i)}),(0,a.jsx)(O,{className:"my-1"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Material Cost"}),(0,a.jsxs)("span",{className:"font-medium text-foreground",children:["$",v.materialCost.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Manufacturing Cost"}),(0,a.jsxs)("span",{className:"font-medium text-foreground",children:["$",v.manufactureCost.toFixed(2)]})]}),h.length>1&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"".concat(S?"text-muted-foreground":"text-muted-foreground/50 line-through"),children:"⚡ Part ID Engraving"}),(0,a.jsx)(x,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0 hover:bg-red-100",onClick:()=>M(!S),title:"Remove Engraving",children:(0,a.jsx)(I.A,{className:"h-3 w-3 text-red-500 hover:text-red-700"})})]}),(0,a.jsxs)("span",{className:"font-medium ".concat(S?"text-foreground":"text-muted-foreground/50 line-through"),children:["$",S?v.partIdEngravingCost.toFixed(2):(1.5*v.totalPartCount).toFixed(2)]})]}),(0,a.jsx)(O,{className:"my-2 font-bold"}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-1",children:[(0,a.jsx)("span",{className:"text-base font-semibold text-foreground",children:"Total Price (inc GST):"}),(0,a.jsxs)("span",{className:"text-xl font-bold text-foreground",children:["$",v.totalIncGST.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Estimated Turnaround:"}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:w?"".concat(w," Day").concat(1!==w?"s":""):"N/A"})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col space-y-2 pt-4 border-t border-gray-200",children:[(0,a.jsxs)(x,{variant:"ghost",onClick:eo,className:"w-full text-muted-foreground hover:text-red-500 transition-colors duration-200",size:"sm",children:[(0,a.jsx)(z.A,{className:"mr-1 h-4 w-4"})," Reset Order"]}),(0,a.jsx)(x,{onClick:el,disabled:0===h.length,className:"w-full text-white font-bold transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"#194431"},onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor="#225539")},onMouseLeave:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor="#194431")},size:"lg",children:"Proceed to Checkout"})]})]}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Add parts to see pricing."})]})]})]})})}),(0,a.jsxs)("main",{className:"flex-grow relative rounded-md border border-gray-200 bg-card flex flex-col items-center justify-center min-h-[300px] h-[40vh] md:h-auto md:min-h-0 max-h-[calc(100vh-180px)] overflow-hidden",children:[eu&&(0,a.jsxs)("div",{className:"absolute top-2 left-2 z-10 bg-blue-100 border border-blue-300 text-blue-700 px-3 py-1 rounded-md text-sm shadow-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Viewing:"})," R:",null==ed?void 0:ed.config.specifiedRadius," W:",null==ed?void 0:ed.config.width," A:",null==ed?void 0:ed.config.angle,"\xb0",(0,a.jsx)("button",{className:"ml-2 text-blue-500 hover:text-blue-700",onClick:()=>Z(null),title:"Clear selection",children:"✕"})]}),(0,a.jsx)("div",{className:"w-full h-full",children:(0,a.jsx)(L,{radius:em,width:eg,angle:ex,materialThickness:eb,arcLength:eN.arcLength,chordLength:eN.chordLength,showDimensions:!0,isPlaceholderMode:!eu&&(0>=Number(ec.specifiedRadius)||0>=Number(ec.width)||0>=Number(ec.angle)),activeFieldHighlight:eu?null:T,isTooLarge:ey.isTooLarge,numSplits:ey.numSplits,splitLinesHovered:F,radiusType:ec.radiusType||"internal"})}),ey.isTooLarge&&(eu||Number(ec.specifiedRadius)>0&&Number(ec.width)>0&&Number(ec.angle)>0)&&(0,a.jsx)("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 cursor-pointer",onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),children:(0,a.jsxs)("div",{className:"border border-orange-400/30 text-orange-600 px-3 py-2 rounded-md flex items-center text-sm shadow-md bg-white",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,a.jsxs)("span",{children:["Will be manufactured in ",ey.numSplits," sections due to size constraints"]})]})})]})]})}):(0,a.jsx)("div",{className:"p-8 text-center",children:"No product configuration available. Please try refreshing."})};function J(){return(0,a.jsx)(Z,{onBack:()=>{}})}},9341:(e,t,i)=>{Promise.resolve().then(i.bind(i,5926))}},e=>{var t=t=>e(e.s=t);e.O(0,[367,831,413,94,441,684,358],()=>t(9341)),_N_E=e.O()}]);