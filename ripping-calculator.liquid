{% comment %}
  Craftons Ripping Calculator Custom Section
  Embeds the ripping calculator directly into product pages
{% endcomment %}

<div class="ripping-calculator-section" style="margin: {{ section.settings.margin_top }}px 0 {{ section.settings.margin_bottom }}px;">
  <div class="ripping-calculator-container" style="max-width: 1600px; margin: 0 auto; padding: 0 20px;">
    {% if section.settings.show_title %}
      <h2 style="text-align: {{ section.settings.title_alignment }}; margin-bottom: 20px;">
        {{ section.settings.title }}
      </h2>
    {% endif %}
    
    {% if section.settings.show_description %}
      <div style="text-align: {{ section.settings.description_alignment }}; margin-bottom: 20px;">
        {{ section.settings.description }}
      </div>
    {% endif %}

    <div style="position: relative; width: 100%; border: {{ section.settings.border_width }}px solid {{ section.settings.border_color }}; border-radius: {{ section.settings.border_radius }}px; overflow: hidden; background: #f9f9f9;">
      <iframe 
        id="ripping-calculator-iframe"
        src="https://craftons-curves-calculator.vercel.app/apps/ripping"
        style="width: 100%; height: 920px; border: none; display: block; transition: height 0.3s ease-in-out;"
        frameborder="0"
        allowfullscreen
        loading="lazy"
        title="Craftons Ripping Calculator">
      </iframe>
    </div>
    
    {% if section.settings.show_note %}
      <div style="margin-top: 15px; font-size: 0.9em; color: #666; text-align: {{ section.settings.note_alignment }};">
        {{ section.settings.note }}
      </div>
    {% endif %}
  </div>
</div>

<script>
(function() {
  // Dynamic iframe height adjustment and product context for Craftons Ripping Calculator
  const iframe = document.getElementById('ripping-calculator-iframe');
  const minHeight = 600;
  const maxHeight = 1400;

  function adjustIframeHeight(height) {
    const constrainedHeight = Math.max(minHeight, Math.min(maxHeight, height));
    if (iframe) {
      iframe.style.height = constrainedHeight + 'px';
      console.log(`üèóÔ∏è Ripping Calculator: Set iframe height to ${constrainedHeight}px`);
    }
  }

  // Listen for height change messages from the ripping calculator
  window.addEventListener('message', function(event) {
    if (event.origin !== 'https://craftons-curves-calculator.vercel.app') {
      return;
    }

    const data = event.data;
    
    if (data.type === 'IFRAME_HEIGHT_CHANGE' && data.source === 'craftons-ripping-calculator') {
      console.log(`üìè Ripping Calculator: Received height update: ${data.height}px`);
      adjustIframeHeight(data.height);
    }
  });

  // Set initial height
  adjustIframeHeight(920);
})();
</script>

{% schema %}
{
  "name": "Ripping Calculator",
  "tag": "section",
  "class": "ripping-calculator-section",
  "settings": [
    {
      "type": "header",
      "content": "Title Settings"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "Show title",
      "default": true
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Sheet Ripping Calculator"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Description Settings"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show description",
      "default": true
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Calculate costs for ripping down full sheets into custom strips with real-time visualization and instant pricing.</p>"
    },
    {
      "type": "select",
      "id": "description_alignment",
      "label": "Description alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border width (px)",
      "min": 0,
      "max": 10,
      "step": 1,
      "default": 1
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e5e5e5"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius (px)",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 8
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Top margin (px)",
      "min": 0,
      "max": 100,
      "step": 10,
      "default": 40
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Bottom margin (px)",
      "min": 0,
      "max": 100,
      "step": 10,
      "default": 40
    },
    {
      "type": "header",
      "content": "Additional Info"
    },
    {
      "type": "checkbox",
      "id": "show_note",
      "label": "Show note",
      "default": false
    },
    {
      "type": "richtext",
      "id": "note",
      "label": "Note",
      "default": "<p>Contact us for custom requirements or bulk orders.</p>"
    },
    {
      "type": "select",
      "id": "note_alignment",
      "label": "Note alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    }
  ],
  "presets": [
    {
      "name": "Ripping Calculator",
      "settings": {
        "title": "Custom Sheet Ripping Calculator",
        "show_title": true,
        "show_description": true,
        "description": "<p>Calculate costs for ripping down full sheets into custom strips with real-time visualization and instant pricing.</p>",
        "border_width": 1,
        "border_color": "#e5e5e5",
        "border_radius": 8,
        "margin_top": 40,
        "margin_bottom": 40
      }
    }
  ]
}
{% endschema %}
