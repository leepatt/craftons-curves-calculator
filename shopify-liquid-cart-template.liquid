{% comment %}
  ================================================================
  SHOPIFY LIQUID CART TEMPLATE FOR CUSTOM CURVES PRODUCT
  ================================================================
  
  This Liquid code handles the display of custom curve products in
  your Shopify cart. It overrides the price and quantity display
  for items with properties._order_type == 'custom_curves'.
  
  INSTALLATION INSTRUCTIONS:
  
  1. Cart Page (sections/main-cart-items.liquid):
     Find the line that renders each cart item (usually inside a 
     {%- for item in cart.items -%} loop). Replace the existing
     cart item render with this code.
  
  2. Cart Drawer (sections/cart-drawer.liquid or snippets/cart-drawer.liquid):
     Apply the same logic in your cart drawer template.
  
  3. Adjust HTML Structure:
     The example below uses Dawn theme structure (table rows).
     Modify the HTML elements and CSS classes to match your theme.
  
  ================================================================
{% endcomment %}

{% comment %}
  Check if the item is a custom curve product.
{% endcomment %}
{%- assign is_custom_curve = false -%}
{%- if item.properties._order_type == 'custom_curves' -%}
  {%- assign is_custom_curve = true -%}
{%- endif -%}

{% comment %}
  ================================================================
  START of cart item row.
  Your theme will have its own structure here. Match the classes
  and element types (e.g., 'cart-item', 'cart-item__media').
  The example below is based on the Dawn theme structure.
  ================================================================
{% endcomment %}
<tr class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
  <td class="cart-item__media">
    {% if item.image %}
      <img class="cart-item__image"
        src="{{ item.image | image_url: width: 300 }}"
        alt="{{ item.image.alt | escape }}"
        loading="lazy"
        width="150"
        height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
      >
    {% endif %}
  </td>

  <td class="cart-item__details">
    <a href="{{ item.url }}" class="cart-item__name h4 break">{{ item.product.title | escape }}</a>

    {% comment %}
      Render all properties EXCEPT those starting with an underscore '_'
    {% endcomment %}
    {%- if item.properties.size > 0 -%}
      <div class="product-options">
        {%- for p in item.properties -%}
          {%- unless p.first startswith '_' or p.last == blank -%}
            <dt class="definition__title">{{ p.first }}:</dt>
            <dd class="definition__description">{{ p.last }}</dd>
          {%- endunless -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    <p class="product-option">{{ item.selling_plan_allocation.selling_plan.name }}</p>

    <a href="{{ routes.cart_change_url }}?line={{ forloop.index }}&amp;quantity=0" class="button button--tertiary">
      {%- render 'icon-remove' -%} {{ 'sections.cart.remove_item' | t: title: item.title }}
    </a>
  </td>

  {% comment %}
    Price for a single item.
  {% endcomment %}
  <td class="cart-item__totals right">
    <div class="cart-item__price-wrapper">
      {%- if is_custom_curve -%}
        {{ item.properties._display_price }}
      {%- else -%}
        {%- render 'price', price: item.price, show_comparison_at_rest: true -%}
      {%- endif -%}
    </div>
  </td>

  {% comment %}
    Quantity input. For custom curves, display a static '1'.
  {% endcomment %}
  <td class="cart-item__quantity">
    <label class="visually-hidden" for="Quantity-{{ item.index | plus: 1 }}">
      {{ 'products.product.quantity.label' | t }}
    </label>
    {%- if is_custom_curve -%}
      <span style="padding: 0 10px;">1</span>
      {% comment %} Hide quantity selector for the custom product {% endcomment %}
    {%- else -%}
      <quantity-input class="quantity">
        <button class="quantity__button no-js-hidden" name="minus" type="button">
          {%- render 'icon-minus' -%}
        </button>
        <input class="quantity__input"
          type="number"
          name="updates[]"
          value="{{ item.quantity }}"
          min="0"
          aria-label="{{ 'products.product.quantity.input_label' | t: product: item.product.title | escape }}"
          id="Quantity-{{ item.index | plus: 1 }}"
          data-index="{{ item.index | plus: 1 }}"
        >
        <button class="quantity__button no-js-hidden" name="plus" type="button">
          {%- render 'icon-plus' -%}
        </button>
      </quantity-input>
    {%- endif -%}
  </td>

  {% comment %}
    Total price for the line item.
  {% endcomment %}
  <td class="cart-item__totals right">
    <div class="cart-item__price-wrapper">
      {%- if is_custom_curve -%}
        {{ item.properties._display_price }}
      {%- else -%}
        {%- render 'price', price: item.final_line_price -%}
      {%- endif -%}
    </div>
  </td>
</tr>

{% comment %}
  ================================================================
  ALTERNATIVE VERSION FOR NON-TABLE THEMES
  ================================================================
  
  If your theme doesn't use tables for the cart, use this div-based
  structure instead. Adjust classes to match your theme.
  ================================================================

<div class="cart-item" id="CartItem-{{ item.index | plus: 1 }}">
  <div class="cart-item__media">
    {% if item.image %}
      <img class="cart-item__image"
        src="{{ item.image | image_url: width: 300 }}"
        alt="{{ item.image.alt | escape }}"
        loading="lazy"
        width="150"
        height="{{ 150 | divided_by: item.image.aspect_ratio | ceil }}"
      >
    {% endif %}
  </div>

  <div class="cart-item__details">
    <h3 class="cart-item__name">
      <a href="{{ item.url }}">{{ item.product.title | escape }}</a>
    </h3>

    {%- if item.properties.size > 0 -%}
      <div class="product-options">
        {%- for p in item.properties -%}
          {%- unless p.first startswith '_' or p.last == blank -%}
            <p><strong>{{ p.first }}:</strong> {{ p.last }}</p>
          {%- endunless -%}
        {%- endfor -%}
      </div>
    {%- endif -%}

    <div class="cart-item__quantity">
      {%- if is_custom_curve -%}
        <span class="quantity-display">Qty: 1</span>
      {%- else -%}
        <div class="quantity-input">
          <button class="quantity-decrease" data-line="{{ forloop.index }}">-</button>
          <input type="number" value="{{ item.quantity }}" min="0" data-line="{{ forloop.index }}">
          <button class="quantity-increase" data-line="{{ forloop.index }}">+</button>
        </div>
      {%- endif -%}
    </div>

    <div class="cart-item__price">
      {%- if is_custom_curve -%}
        <span class="price">{{ item.properties._display_price }}</span>
      {%- else -%}
        <span class="price">{{ item.final_line_price | money }}</span>
      {%- endif -%}
    </div>

    <button class="cart-item__remove" data-line="{{ forloop.index }}">
      Remove
    </button>
  </div>
</div>

{% endcomment %}